# Milestone v2.2: Dashboard Upload & Listing UI

**Status:** SHIPPED 2026-01-30
**Phases:** 13-16
**Total Plans:** 4

## Overview

Build the frontend interface for uploading Excel files and viewing ingested data, connecting the Next.js dashboard to the batch/row API endpoints built in v2.0-v2.1. Complete project detail page with batch history grid, upload modal with visual mode selector and drag-and-drop, and batch data table with server-side pagination.

## Phases

### Phase 13: API Foundation & Project Detail Page

**Goal**: Frontend batch API plumbing with FormData upload fix, Zod validation, React Query hooks, and project detail page shell
**Depends on**: v2.0 (batch upload endpoint), v2.1 (batch read layer)
**Plans**: 1 plan

Plans:
- [x] 13-01: API Foundation & Project Detail Page (FormData fix, Zod schemas, React Query hooks, project detail page)

**Details:**
- Fixed API client to support FormData uploads without breaking multipart boundary
- Created complete Zod validation layer for batch responses (list, detail, rows)
- Built React Query hooks for all batch operations with cache invalidation
- Delivered project detail page with breadcrumb, header, empty state, and loading skeletons

### Phase 14: Upload Modal

**Goal**: Upload modal with List/Profile mode selector cards, drag-and-drop .xlsx validation, and FormData upload integration
**Depends on**: Phase 13
**Plans**: 1 plan

Plans:
- [x] 14-01: Upload Modal (mode selector, react-dropzone, file validation, upload mutation)

**Details:**
- UploadBatchModal component with two-step flow (mode selection -> file upload)
- Drag-and-drop zone with dragover visual feedback and click-to-browse fallback
- Client-side validation rejecting non-.xlsx, >5MB, and wrong file counts with Portuguese toast messages
- Modal close blocking during active upload

### Phase 15: Batch Grid

**Goal**: Responsive batch card grid with Portuguese relative dates, colored mode badges, skeleton loading, and upload CTA in empty state
**Depends on**: Phase 14
**Plans**: 1 plan

Plans:
- [x] 15-01: Batch Grid (BatchCard, BatchGrid, responsive layout, empty state CTA)

**Details:**
- BatchCard component displays batch history with clickable navigation to batch detail pages
- BatchGrid handles three states: loading (6 skeletons), empty (with upload CTA), data (responsive grid)
- Portuguese relative dates using Intl.RelativeTimeFormat
- Colored mode badges: blue for LIST_MODE, purple for PROFILE_MODE

### Phase 16: Data Table with Pagination

**Goal**: Batch detail page with dynamic-column data table, server-side pagination with page size selector, and keepPreviousData for smooth transitions
**Depends on**: Phase 15
**Plans**: 1 plan

Plans:
- [x] 16-01: Data Table with Pagination (batch detail page, dynamic columns, pagination controls, empty state)

**Details:**
- Batch detail route at /projects/[id]/batches/[batchId]
- Dynamic columns generated from batch.columnMetadata sorted by position
- Server-side pagination with limit/offset and page size selector (25/50/100)
- keepPreviousData for smooth page transitions (no loading flash)
- Sticky row number column, cell truncation with tooltips
- Smart page number ellipsis algorithm

---

## Milestone Summary

**Key Decisions:**
- FormData uploads skip Content-Type header to allow browser auto-generation of multipart boundary
- Batch list hook uses fixed query key without limit/offset to simplify cache invalidation
- Used react-dropzone for drag-and-drop with .xlsx validation and 5MB size limit
- Mode selector uses shadcn Card components with visual selection state
- Used Intl.RelativeTimeFormat('pt-BR') for Portuguese relative dates
- keepPreviousData in useBatchRows hook for smooth pagination transitions
- Dynamic column generation from batch.columnMetadata preserves Excel column order
- Sticky row number column with z-index and bg-background

**Issues Resolved:**
- react-dropzone v14 TypeScript type incompatibility with strict mode (resolved with type assertions)
- FormData Content-Type header breaking multipart boundary (resolved with conditional skip)
- Next.js 15 async params (resolved with React use() hook)

**Issues Deferred:**
- Column resizing, filtering, sorting (future enhancement milestones)
- Row selection and bulk operations (future v3.0)
- Virtual scrolling for large datasets (future optimization)

**Technical Debt Incurred:**
- react-dropzone v14 type assertions (library type definitions incomplete for strict TypeScript)
- Tooltip on every cell adds DOM overhead (acceptable for MVP, 25-100 rows)
- Pre-existing ESLint errors (6 issues in v1.0 code, not introduced by v2.2)

---

_For current project status, see .planning/ROADMAP.md_
