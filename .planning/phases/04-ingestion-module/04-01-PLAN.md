---
phase: 04-ingestion-module
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/api/src/infrastructure/excel/ingestion.module.ts
  - apps/api/src/app.module.ts
autonomous: true

must_haves:
  truths:
    - "IngestionModule imports ExcelModule to access strategy tokens"
    - "IngestionModule provides and exports IngestionService for use case injection"
    - "AppModule imports IngestionModule so DI can bootstrap the ingestion subsystem"
    - "TypeScript compiles cleanly with the new module wiring"
  artifacts:
    - path: "apps/api/src/infrastructure/excel/ingestion.module.ts"
      provides: "NestJS module wiring strategies and ingestion service"
      contains: "IngestionModule"
    - path: "apps/api/src/app.module.ts"
      provides: "Root module with IngestionModule import"
      contains: "IngestionModule"
  key_links:
    - from: "apps/api/src/infrastructure/excel/ingestion.module.ts"
      to: "apps/api/src/infrastructure/excel/excel.module.ts"
      via: "imports array"
      pattern: "imports.*ExcelModule"
    - from: "apps/api/src/infrastructure/excel/ingestion.module.ts"
      to: "apps/api/src/infrastructure/excel/ingestion.service.ts"
      via: "providers and exports arrays"
      pattern: "providers.*IngestionService.*exports.*IngestionService"
    - from: "apps/api/src/app.module.ts"
      to: "apps/api/src/infrastructure/excel/ingestion.module.ts"
      via: "imports array"
      pattern: "imports.*IngestionModule"
---

<objective>
Create `IngestionModule` NestJS module that wires ExcelModule strategies with IngestionService and register it in AppModule.

Purpose: Phase 5 (CreateBatchUseCase) needs IngestionService available via NestJS DI. This module bridges the Excel parsing strategies (Phase 2) and the ingestion orchestration service (Phase 3) into a single importable unit.

Output: `ingestion.module.ts` providing IngestionService, `app.module.ts` updated with IngestionModule import.
</objective>

<execution_context>
@/Users/luanmartins/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luanmartins/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Source files for this plan
@apps/api/src/infrastructure/excel/excel.module.ts
@apps/api/src/infrastructure/excel/excel.constants.ts
@apps/api/src/infrastructure/excel/ingestion.service.ts
@apps/api/src/app.module.ts
@apps/api/src/infrastructure/database/drizzle/drizzle.module.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create IngestionModule and register in AppModule</name>
  <files>
    apps/api/src/infrastructure/excel/ingestion.module.ts
    apps/api/src/app.module.ts
  </files>
  <action>
Create `apps/api/src/infrastructure/excel/ingestion.module.ts`:

1. Import `Module` from `@nestjs/common`
2. Import `ExcelModule` from `./excel.module`
3. Import `IngestionService` from `./ingestion.service`
4. Create `@Module()` decorated class `IngestionModule` with:
   - `imports: [ExcelModule]` -- this gives IngestionService access to LIST_MODE_STRATEGY and PROFILE_MODE_STRATEGY tokens exported by ExcelModule
   - `providers: [IngestionService]` -- registers IngestionService in this module's DI container
   - `exports: [IngestionService]` -- makes IngestionService available to modules that import IngestionModule (Phase 5 CreateBatchUseCase will need this)
5. Add JSDoc explaining the module's purpose and what it exports

Note: BatchRepository and RowRepository are NOT listed in imports because DrizzleModule is @Global() -- it already provides these abstract repositories globally. Only ExcelModule needs explicit import because it is NOT global.

Then update `apps/api/src/app.module.ts`:

1. Add import statement for `IngestionModule` from `./infrastructure/excel/ingestion.module`
2. Add `IngestionModule` to the `imports` array (after TransactionModule, before AuthModule -- keeps infrastructure modules grouped logically)

Follow the exact same module pattern as ExcelModule (same file in same directory) and ProjectModule (for AppModule registration pattern).
  </action>
  <verify>
Run `npx tsc --noEmit` from `apps/api/` to confirm TypeScript compilation succeeds with the new module wiring.
  </verify>
  <done>
IngestionModule exists, imports ExcelModule, provides and exports IngestionService. AppModule imports IngestionModule. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `apps/api/src/infrastructure/excel/ingestion.module.ts` exists and exports `IngestionModule`
2. IngestionModule `imports` array contains `ExcelModule`
3. IngestionModule `providers` array contains `IngestionService`
4. IngestionModule `exports` array contains `IngestionService`
5. `apps/api/src/app.module.ts` `imports` array contains `IngestionModule`
6. `npx tsc --noEmit` passes from `apps/api/`
</verification>

<success_criteria>
- IngestionModule provides both strategies (via ExcelModule import) and the ingestion service
- IngestionModule exports IngestionService for use case injection in Phase 5
- AppModule bootstraps the ingestion subsystem
- Zero TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-ingestion-module/04-01-SUMMARY.md`
</output>
