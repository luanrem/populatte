---
phase: 15-batch-grid
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/projects/batch-card.tsx
  - apps/web/components/projects/batch-grid.tsx
  - apps/web/components/projects/batch-empty-state.tsx
  - apps/web/app/(platform)/projects/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Project detail page displays batch cards in a responsive grid (3 cols desktop, 1 col mobile)"
    - "Each batch card shows creation date (relative), mode badge (colored), and row count"
    - "Clicking a batch card navigates to /projects/[id]/batches/[batchId]"
    - "Empty state with upload CTA is shown when project has zero batches"
    - "Six skeleton cards are displayed while batch data is loading"
    - "Grid is sorted newest-first (API default, no client sort needed)"
  artifacts:
    - path: "apps/web/components/projects/batch-card.tsx"
      provides: "Batch card with date, mode badge, row count, and navigation"
      min_lines: 40
    - path: "apps/web/components/projects/batch-grid.tsx"
      provides: "Batch grid with empty state, skeletons, and card rendering"
      min_lines: 50
    - path: "apps/web/components/projects/batch-empty-state.tsx"
      provides: "Empty state with upload CTA button (updated from Phase 13)"
    - path: "apps/web/app/(platform)/projects/[id]/page.tsx"
      provides: "Project detail page wired to BatchGrid component"
  key_links:
    - from: "apps/web/app/(platform)/projects/[id]/page.tsx"
      to: "apps/web/components/projects/batch-grid.tsx"
      via: "BatchGrid component with batches data and onUploadClick"
      pattern: "<BatchGrid"
    - from: "apps/web/components/projects/batch-grid.tsx"
      to: "apps/web/components/projects/batch-card.tsx"
      via: "Maps over batches items to render BatchCard components"
      pattern: "<BatchCard"
    - from: "apps/web/components/projects/batch-card.tsx"
      to: "/projects/[id]/batches/[batchId]"
      via: "Next.js Link component wrapping card for navigation"
      pattern: "href=.*batches/"
    - from: "apps/web/components/projects/batch-empty-state.tsx"
      to: "onUploadClick callback"
      via: "Button onClick triggers upload modal open"
      pattern: "onUploadClick"
---

<objective>
Build the batch card grid for the project detail page. Users see their batch import history as a responsive card grid with mode badges, relative dates, row counts, and clickable navigation to batch detail pages. Includes empty state with upload CTA and skeleton loading.

Purpose: Users need to see their uploaded batch history and navigate to individual batch data. This is the central hub of the project detail page.
Output: BatchCard component, BatchGrid component (with skeletons/empty state), updated BatchEmptyState with upload CTA, wired project detail page.
</objective>

<execution_context>
@/Users/luanmartins/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luanmartins/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/app/(platform)/projects/[id]/page.tsx
@apps/web/components/projects/project-card.tsx
@apps/web/components/projects/project-grid.tsx
@apps/web/components/projects/batch-empty-state.tsx
@apps/web/lib/api/schemas/batch.schema.ts
@apps/web/lib/query/hooks/use-batches.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BatchCard component and BatchGrid with skeletons</name>
  <files>
    apps/web/components/projects/batch-card.tsx
    apps/web/components/projects/batch-grid.tsx
  </files>
  <action>
Create `batch-card.tsx` — a clickable card component for a single batch:

**Props:** `batch: BatchResponse` and `projectId: string`

**Card structure (stacked vertical layout, fixed height):**
- Wrap entire card in Next.js `Link` to `/projects/${projectId}/batches/${batch.id}`
- Use shadcn `Card` component with hover effect: `transition-all hover:shadow-md hover:-translate-y-0.5`
- **Top:** Relative creation date in Portuguese using `Intl.RelativeTimeFormat('pt-BR')` — create a small helper function inside the file (e.g., `formatRelativeDate`) that takes an ISO date string and returns text like "2 horas atras", "ontem", "3 dias atras". Use `Date.now() - new Date(dateStr).getTime()` to compute delta, then pick the best unit (minutes, hours, days, weeks, months). Display with `Calendar` icon from lucide-react and muted text.
- **Middle:** Mode badge using shadcn `Badge`:
  - `LIST_MODE` → blue badge text "Modo Lista" (use className for blue: `bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 hover:bg-blue-100`)
  - `PROFILE_MODE` → purple badge text "Modo Perfil" (use className for purple: `bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 hover:bg-purple-100`)
- **Bottom:** Row count with `Rows` icon from lucide-react — "{batch.totalRows} registros" in muted text
- **Right side:** `ChevronRight` icon from lucide-react as clickability affordance, muted, vertically centered

**Import types from:** `@/lib/api/schemas/batch.schema` (BatchResponse type)

Create `batch-grid.tsx` — the grid container component:

**Props interface:**
```typescript
interface BatchGridProps {
  batches?: BatchListResponse;
  isLoading: boolean;
  onUploadClick: () => void;
}
```

**Three states:**
1. **Loading:** Render 6 skeleton cards using shadcn `Skeleton` in the same grid layout. Each skeleton card should match the batch card shape: a rounded-lg border container with skeleton lines for date, badge, and row count (similar to `ProjectCardSkeleton` pattern in `project-grid.tsx`).
2. **Empty:** Render `<BatchEmptyState onUploadClick={onUploadClick} />` when `batches.items.length === 0`
3. **Data:** Render batch cards in a responsive grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`. Map over `batches.items` rendering `<BatchCard>` for each. Pass `projectId` from `batches.items[0].projectId` — but since the component receives the full BatchListResponse, extract projectId from props (add `projectId: string` to props).

**Updated props:**
```typescript
interface BatchGridProps {
  projectId: string;
  batches?: BatchListResponse;
  isLoading: boolean;
  onUploadClick: () => void;
}
```

Import `BatchListResponse` type from `@/lib/api/schemas/batch.schema`.
  </action>
  <verify>
Run `cd /Users/luanmartins/source/projects/populatte && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | head -30` — no type errors in new files.
Run `npm run lint --filter=@populatte/web 2>&1 | tail -20` — no lint errors in new files.
  </verify>
  <done>
BatchCard renders a clickable card with relative date, colored mode badge, row count, and chevron icon. BatchGrid renders 6 skeletons when loading, BatchEmptyState when empty, or card grid when data exists. Both files compile and lint cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update BatchEmptyState with upload CTA and wire BatchGrid into project detail page</name>
  <files>
    apps/web/components/projects/batch-empty-state.tsx
    apps/web/app/(platform)/projects/[id]/page.tsx
  </files>
  <action>
**Update `batch-empty-state.tsx`:**

The current BatchEmptyState has no CTA button — it just tells the user to click "Nova Importacao" in the header. Per CONTEXT.md, the empty state should have a direct CTA button that opens the upload modal.

Add `onUploadClick: () => void` prop to the component. Add a shadcn `Button` below the text paragraph that says "Enviar planilha" with an `Upload` icon from lucide-react. Wire `onClick={onUploadClick}`.

Keep the existing illustration (FileSpreadsheet icon in dashed circle) and text. Just add the button below.

Update the component signature:
```typescript
interface BatchEmptyStateProps {
  onUploadClick: () => void;
}

export function BatchEmptyState({ onUploadClick }: BatchEmptyStateProps) {
```

**Update `page.tsx` (project detail page):**

Replace the current batch content zone (lines ~144-157 with the inline skeleton/empty/placeholder logic) with the `BatchGrid` component.

1. Import `BatchGrid` from `@/components/projects/batch-grid`
2. Remove the inline `batchesLoading` / `BatchEmptyState` / placeholder text block
3. Replace with:
```tsx
<BatchGrid
  projectId={id}
  batches={batches}
  isLoading={batchesLoading}
  onUploadClick={() => setUploadModalOpen(true)}
/>
```
4. Remove the direct `BatchEmptyState` import (it's now used only inside BatchGrid)
5. Keep all other page logic (breadcrumb, header, upload modal, error states) unchanged

The page should NOT import BatchEmptyState directly anymore — BatchGrid handles it internally.
  </action>
  <verify>
Run `cd /Users/luanmartins/source/projects/populatte && npx tsc --noEmit -p apps/web/tsconfig.json 2>&1 | head -30` — no type errors.
Run `npm run lint --filter=@populatte/web 2>&1 | tail -20` — no lint errors.
Verify BatchEmptyState has onUploadClick prop: `grep -n "onUploadClick" apps/web/components/projects/batch-empty-state.tsx`
Verify BatchGrid is used in page: `grep -n "BatchGrid" apps/web/app/\(platform\)/projects/\[id\]/page.tsx`
Verify BatchEmptyState is NOT directly imported in page: `grep -c "batch-empty-state" apps/web/app/\(platform\)/projects/\[id\]/page.tsx` should return 0.
  </verify>
  <done>
BatchEmptyState has direct "Enviar planilha" CTA button that triggers upload modal. Project detail page uses BatchGrid component instead of inline conditional rendering. BatchGrid internally handles loading/empty/data states. Page is cleaner with BatchGrid encapsulating batch display logic.
  </done>
</task>

</tasks>

<verification>
1. Type check: `cd /Users/luanmartins/source/projects/populatte && npx tsc --noEmit -p apps/web/tsconfig.json` — zero errors
2. Lint: `npm run lint --filter=@populatte/web` — zero errors
3. File existence: All 4 files exist (batch-card.tsx, batch-grid.tsx, batch-empty-state.tsx updated, page.tsx updated)
4. Key connections:
   - page.tsx imports and renders BatchGrid with projectId, batches, isLoading, onUploadClick
   - BatchGrid imports and renders BatchCard for each batch item
   - BatchGrid imports and renders BatchEmptyState when no batches
   - BatchCard wraps in Link to `/projects/${projectId}/batches/${batchId}`
   - BatchEmptyState has onUploadClick prop wired to Button
5. Pattern conformance: Card follows ProjectCard pattern (shadcn Card + hover), Grid follows ProjectGrid pattern (3-col responsive + skeletons)
</verification>

<success_criteria>
- Batch cards render in responsive 3-column grid with hover effects
- Each card shows: relative date (Portuguese), colored mode badge (blue/purple), row count, chevron
- Clicking card navigates to /projects/[id]/batches/[batchId]
- Empty state shows illustration + text + "Enviar planilha" button that opens upload modal
- 6 skeleton cards appear during loading
- TypeScript and ESLint pass with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-batch-grid/15-01-SUMMARY.md`
</output>
