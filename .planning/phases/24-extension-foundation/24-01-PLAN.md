---
phase: 24-extension-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/extension/package.json
  - apps/extension/wxt.config.ts
  - apps/extension/tsconfig.json
  - apps/extension/entrypoints/popup/index.html
  - apps/extension/entrypoints/popup/main.tsx
  - apps/extension/entrypoints/popup/App.tsx
  - apps/extension/entrypoints/background.ts
  - apps/extension/entrypoints/content.ts
  - apps/extension/styles/globals.css
  - apps/extension/public/icon-16.png
  - apps/extension/public/icon-32.png
  - apps/extension/public/icon-48.png
  - apps/extension/public/icon-128.png
autonomous: true

must_haves:
  truths:
    - "Extension loads in Chrome developer mode without errors"
    - "Popup opens when clicking extension icon"
    - "Service worker initializes on extension load"
    - "Content script injects into web pages"
    - "Shared types from @populatte/types are importable"
  artifacts:
    - path: "apps/extension/package.json"
      provides: "Extension package configuration"
      contains: "wxt"
    - path: "apps/extension/wxt.config.ts"
      provides: "WXT build configuration"
      contains: "defineConfig"
    - path: "apps/extension/entrypoints/popup/App.tsx"
      provides: "React popup root component"
      contains: "Populatte"
    - path: "apps/extension/entrypoints/background.ts"
      provides: "Service worker entry"
      contains: "defineBackground"
    - path: "apps/extension/entrypoints/content.ts"
      provides: "Content script entry"
      contains: "defineContentScript"
  key_links:
    - from: "apps/extension/wxt.config.ts"
      to: "manifest generation"
      via: "WXT convention"
      pattern: "manifest:"
    - from: "apps/extension/entrypoints/popup/main.tsx"
      to: "apps/extension/entrypoints/popup/App.tsx"
      via: "React render"
      pattern: "createRoot.*App"
    - from: "apps/extension/tsconfig.json"
      to: "@populatte/types"
      via: "TypeScript paths"
      pattern: "@populatte/types"
---

<objective>
Scaffold the Chrome extension using WXT framework with all three execution contexts (popup, background, content script) working and @populatte/types integrated.

Purpose: Establish the extension infrastructure that all subsequent phases build upon. This is the foundation for auth, popup UI, and content script functionality.

Output: A working Chrome extension that loads in developer mode with React popup, service worker, and content script ready for feature implementation, with shared types available.
</objective>

<execution_context>
@/Users/luanmartins/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luanmartins/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-extension-foundation/24-CONTEXT.md
@.planning/research/STACK-extension.md
@apps/web/package.json
@packages/types/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize WXT project with React and @populatte/types</name>
  <files>
    apps/extension/package.json
    apps/extension/wxt.config.ts
    apps/extension/tsconfig.json
    apps/extension/styles/globals.css
  </files>
  <action>
Create the apps/extension directory structure from scratch (do NOT use npx wxt init as it's interactive).

1. Create `apps/extension/package.json`:
```json
{
  "name": "@populatte/extension",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "wxt",
    "dev:firefox": "wxt -b firefox",
    "build": "wxt build",
    "build:firefox": "wxt build -b firefox",
    "zip": "wxt zip",
    "lint": "eslint entrypoints src",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "react": "19.2.0",
    "react-dom": "19.2.0",
    "lucide-react": "0.555.0",
    "@populatte/types": "*"
  },
  "devDependencies": {
    "wxt": "^0.20.13",
    "@wxt-dev/module-react": "^1.1.5",
    "@types/chrome": "^0.0.287",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "typescript": "^5",
    "tailwindcss": "^4",
    "@tailwindcss/vite": "^4"
  }
}
```

Note: `@populatte/types` is added as a workspace dependency using `"*"` to reference the local package.

2. Create `apps/extension/wxt.config.ts`:
```typescript
import { defineConfig } from 'wxt';
import tailwindcss from '@tailwindcss/vite';

export default defineConfig({
  modules: ['@wxt-dev/module-react'],
  manifest: {
    name: 'Populatte',
    description: 'Automate web form filling from your data',
    permissions: ['storage', 'activeTab', 'scripting'],
    host_permissions: ['<all_urls>'],
    action: {
      default_title: 'Populatte',
    },
  },
  vite: () => ({
    plugins: [tailwindcss()],
    resolve: {
      alias: {
        '@': './src',
        '@populatte/types': '../../packages/types/src',
      },
    },
  }),
});
```

3. Create `apps/extension/tsconfig.json`:
```json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "jsx": "react-jsx",
    "esModuleInterop": true,
    "skipLibCheck": true,
    "noUncheckedIndexedAccess": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@populatte/types": ["../../packages/types/src"],
      "@populatte/types/*": ["../../packages/types/src/*"]
    },
    "types": ["chrome"]
  },
  "include": ["src", "entrypoints", "wxt.config.ts", ".wxt/types"],
  "exclude": ["node_modules", ".output"]
}
```

4. Create `apps/extension/styles/globals.css`:
```css
@import "tailwindcss";
```
  </action>
  <verify>
    Files exist: `ls apps/extension/package.json apps/extension/wxt.config.ts apps/extension/tsconfig.json apps/extension/styles/globals.css`
    Types path configured: `grep "@populatte/types" apps/extension/tsconfig.json`
  </verify>
  <done>WXT project configuration files created with React, Tailwind, TypeScript support, and @populatte/types integration</done>
</task>

<task type="auto">
  <name>Task 2: Create extension entrypoints and icons</name>
  <files>
    apps/extension/entrypoints/popup/index.html
    apps/extension/entrypoints/popup/main.tsx
    apps/extension/entrypoints/popup/App.tsx
    apps/extension/entrypoints/background.ts
    apps/extension/entrypoints/content.ts
    apps/extension/public/icon-16.png
    apps/extension/public/icon-32.png
    apps/extension/public/icon-48.png
    apps/extension/public/icon-128.png
  </files>
  <action>
1. Create `apps/extension/entrypoints/popup/index.html`:
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Populatte</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./main.tsx"></script>
  </body>
</html>
```

2. Create `apps/extension/entrypoints/popup/main.tsx`:
```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import '../../styles/globals.css';

const root = document.getElementById('root');
if (root) {
  ReactDOM.createRoot(root).render(
    <React.StrictMode>
      <App />
    </React.StrictMode>
  );
}
```

3. Create `apps/extension/entrypoints/popup/App.tsx`:
```tsx
import { Coffee } from 'lucide-react';

export default function App() {
  return (
    <div className="w-[350px] h-[500px] bg-white p-4">
      <header className="flex items-center gap-2 mb-4 pb-3 border-b">
        <Coffee className="w-6 h-6 text-amber-700" />
        <h1 className="text-lg font-semibold text-gray-900">Populatte</h1>
      </header>

      <main className="space-y-4">
        <div className="p-3 bg-amber-50 rounded-lg border border-amber-200">
          <p className="text-sm text-amber-800">
            Extension loaded successfully. Ready for auth integration.
          </p>
        </div>

        <div className="text-xs text-gray-500">
          <p>Status: Disconnected</p>
          <p>Version: 0.1.0</p>
        </div>
      </main>
    </div>
  );
}
```

4. Create `apps/extension/entrypoints/background.ts` (MINIMAL - storage and messaging added in later plans):
```typescript
export default defineBackground(() => {
  console.log('[Populatte] Service worker initialized');

  // Log when extension is installed or updated
  browser.runtime.onInstalled.addListener((details) => {
    console.log('[Populatte] Extension installed/updated:', details.reason);
  });
});
```

5. Create `apps/extension/entrypoints/content.ts`:
```typescript
export default defineContentScript({
  matches: ['<all_urls>'],
  runAt: 'document_idle',

  main() {
    console.log('[Populatte] Content script loaded on:', window.location.hostname);
  },
});
```

6. Create placeholder icons using valid PNG data.

Create `apps/extension/public/` directory, then create each icon file with valid PNG binary data.

Use this Node.js script approach (run once during task execution):

```javascript
// Create minimal valid PNG files for each size
// These are simple amber-colored squares that serve as placeholders

import { writeFileSync, mkdirSync } from 'fs';
import { dirname } from 'path';

// Minimal valid PNG (1x1 amber pixel) - this works but looks tiny
// For better placeholders, we'll create properly sized PNGs

// Base64 encoded minimal amber PNG data for each size
// These are valid PNGs that will display as amber squares
const pngData = {
  16: 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAH0lEQVQ4y2P4z8Dwn4GBgYGRgYGBEZ0GUYaLtGEAAEJKCf+5yWPDAAAAAElFTkSuQmCC',
  32: 'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAJklEQVRYw+3OAQkAAAwCMGT/zuYCJ7WAY1cmhYWFhYWFhYWF/RdYZRAJ/9fKZQAAAABJRU5ErkJggg==',
  48: 'iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAKklEQVRoge3OMQEAAAgDoK1/6WHoARkgtJck0mQwGAwGg8FgMBgMf4MXxCQQCf/lYVMAAAAASUVORK5CYII=',
  128: 'iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAPElEQVR42u3BAQ0AAAgAoLu/0NPA0wcImxYBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgNqMAAATB/l2YAAAAASUVORK5CYII='
};

mkdirSync('apps/extension/public', { recursive: true });

for (const [size, base64] of Object.entries(pngData)) {
  const buffer = Buffer.from(base64, 'base64');
  writeFileSync(`apps/extension/public/icon-${size}.png`, buffer);
  console.log(`Created icon-${size}.png`);
}
```

Alternatively, create the icons directly using the Write tool with base64-decoded binary data, or download placeholder icons from a CDN like:
```bash
curl -o apps/extension/public/icon-16.png "https://placehold.co/16x16/b45309/white.png"
curl -o apps/extension/public/icon-32.png "https://placehold.co/32x32/b45309/white.png"
curl -o apps/extension/public/icon-48.png "https://placehold.co/48x48/b45309/white.png"
curl -o apps/extension/public/icon-128.png "https://placehold.co/128x128/b45309/white.png"
```

The curl approach is simplest and produces real, properly-sized PNG files with the amber brand color (#b45309).
  </action>
  <verify>
    Files exist: `ls apps/extension/entrypoints/popup/index.html apps/extension/entrypoints/popup/main.tsx apps/extension/entrypoints/popup/App.tsx apps/extension/entrypoints/background.ts apps/extension/entrypoints/content.ts`
    Icons exist and are valid PNGs: `file apps/extension/public/icon-*.png`
  </verify>
  <done>All three extension contexts (popup, background, content) have entry files, and valid placeholder icons exist</done>
</task>

<task type="auto">
  <name>Task 3: Install dependencies and verify extension loads</name>
  <files>
    apps/extension/node_modules
    apps/extension/.output
  </files>
  <action>
1. Install dependencies:
```bash
cd apps/extension
npm install
```

2. Build the extension:
```bash
npm run build
```

3. Verify build output exists:
```bash
ls -la .output/chrome-mv3
```

The build should produce:
- `.output/chrome-mv3/manifest.json`
- `.output/chrome-mv3/popup.html`
- `.output/chrome-mv3/background.js`
- `.output/chrome-mv3/content-scripts/content.js`

4. Verify @populatte/types is resolvable by checking the build succeeds without module resolution errors.

5. Instructions for manual Chrome verification (to be done by user):
   - Open Chrome and go to `chrome://extensions`
   - Enable "Developer mode" (toggle in top right)
   - Click "Load unpacked"
   - Select the `apps/extension/.output/chrome-mv3` directory
   - Extension should appear in toolbar
   - Click extension icon - popup should open showing "Populatte" header

Note: The actual Chrome loading is verified via checkpoint in subsequent phase. For now, verify the build succeeds.
  </action>
  <verify>
    `cd apps/extension && npm run build && ls .output/chrome-mv3/manifest.json`
  </verify>
  <done>Extension builds successfully and produces valid Chrome extension output</done>
</task>

</tasks>

<verification>
1. `apps/extension/package.json` exists with wxt, react, and @populatte/types dependencies
2. `apps/extension/wxt.config.ts` configures manifest with Populatte name and permissions
3. `apps/extension/tsconfig.json` has paths configured for @populatte/types
4. `apps/extension/entrypoints/popup/App.tsx` renders React component
5. `apps/extension/entrypoints/background.ts` exports defineBackground (minimal version)
6. `apps/extension/entrypoints/content.ts` exports defineContentScript
7. `apps/extension/public/icon-*.png` files exist and are valid PNGs
8. `npm run build` in apps/extension succeeds
9. `.output/chrome-mv3/manifest.json` contains correct name and permissions
</verification>

<success_criteria>
- WXT project structure created at apps/extension
- @populatte/types integrated and importable
- All three entrypoints (popup, background, content) defined
- TypeScript and Tailwind CSS configured
- Valid placeholder icons exist for all required sizes
- Extension builds without errors
- Build output contains valid manifest.json with "Populatte" name
</success_criteria>

<output>
After completion, create `.planning/phases/24-extension-foundation/24-01-SUMMARY.md`
</output>
